================================================================================
                    ДИАГНОСТИКА ПОТЕРИ СЛОВ ПРИ ОЗВУЧКЕ
================================================================================

ПРОБЛЕМА:
---------
При озвучке книги пропадают слова или буквы.

ВОЗМОЖНЫЕ ПРИЧИНЫ:
------------------

1. РАЗБИВКА ТЕКСТА (chunk_text)
   Статус: ПРОВЕРЕНО - работает правильно
   Тест: test_text_chunking.py показал что все слова сохраняются

2. ОБРЕЗКА РЕФЕРЕНСА (строка 505)
   Код: generated = generated[:, ref_audio_len:, :]

   Проблема: Модель генерирует [ref_audio + new_text], затем обрезает ref_audio.
   Если модель неправильно выровняла начало, может обрезать полезный текст!

   Решение: Добавлено логирование (строка 508-512) чтобы видеть когда
   генерация короче ожидаемого.

3. VOCODER
   Vocoder (vocos) может "проглатывать" тихие звуки или быстро произносимые слова.

   Решение: Нет пока, требует экспериментов с другими vocoder.

4. МОДЕЛЬ F5-TTS
   Модель может пропускать слова если:
   - Текст слишком длинный для одного куска
   - Скорость генерации (speed) слишком высокая
   - Слова идут слишком близко друг к другу без пауз

   Решение: Попробуй уменьшить max_chars при разбивке текста

ДОБАВЛЕННЫЕ УЛУЧШЕНИЯ:
-----------------------

1. Логирование текста (строки 479-481):
   [DEBUG] gen_text (N chars): текст...
   [DEBUG] full_text: ref_text + gen_text...

   Это покажет какой текст отправляется в модель.

2. Проверка длины аудио (строки 508-512):
   [WARNING] Сгенерировано короче ожидаемого: X < Y (90%)

   Если модель генерирует короче ожидаемого - возможно пропущены слова.

КАК ДИАГНОСТИРОВАТЬ:
---------------------

ШАГ 1: Запусти тест целостности
   python test_generation_integrity.py

   Этот тест озвучит 10 чисел: "Один. Два. Три..." и тд.
   Прослушай outputs/test_integrity.wav

   Если числа пропущены - проблема в модели/vocoder.
   Если все числа есть - проблема где-то еще.

ШАГ 2: Посмотри логи при озвучке книги
   Ищи строки:
   - [DEBUG] gen_text - смотри какой текст отправляется
   - [WARNING] Сгенерировано короче - модель не справляется

ШАГ 3: Уменьши размер кусков
   В своём скрипте озвучки найди max_chars и уменьши:
   - Было: max_chars=80
   - Попробуй: max_chars=50

   Меньшие куски = больше кусков, но меньше шанс потерять слова.

ШАГ 4: Проверь reference_audio
   Если референс слишком короткий, модель может "спешить".
   Попробуй использовать референс длиной 10-15 секунд.

ШАГ 5: Сохраняй куски отдельно
   В коде уже есть сохранение кусков в outputs/audio_parts/
   Прослушай куски по отдельности и найди где именно теряются слова.

ИЗВЕСТНЫЕ ОГРАНИЧЕНИЯ F5-TTS:
------------------------------

1. Модель работает лучше на предложениях средней длины (5-10 слов)
2. Слишком длинные предложения (15+ слов) могут привести к пропускам
3. Быстрая речь (speed > 1.0) увеличивает шанс пропусков
4. Сложные слова или неизвестные модели могут "проглатываться"

РЕКОМЕНДАЦИИ:
--------------

1. Используй max_chars=50-70 для русского языка
2. Убедись что референс качественный и 10+ секунд
3. Не используй speed > 1.0
4. Разбивай длинные предложения на короткие
5. Проверяй куски (outputs/audio_parts/) перед финальной склейкой

================================================================================
