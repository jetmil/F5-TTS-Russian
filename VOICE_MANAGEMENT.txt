================================================================================
                         СИСТЕМА УПРАВЛЕНИЯ ГОЛОСАМИ
================================================================================

ОБЗОР:
------
Добавлена система управления голосами в Gradio интерфейс F5-TTS.
Теперь можно сохранять, загружать и управлять библиотекой голосов.

ФАЙЛЫ:
------
1. src/f5_tts/infer/infer_gradio.py (ИЗМЕНЕН)
   - Добавлены функции управления голосами (строки 137-243)
   - Добавлен UI в tab "Basic-TTS" (строки 330-355)
   - Добавлены обработчики событий (строки 464-486)

2. voices/ (НОВАЯ ПАПКА)
   - Хранилище сохраненных голосов
   - Структура: voices/Voice_Name/audio.wav + metadata.json

3. add_example_voice.py (НОВЫЙ СКРИПТ)
   - Скрипт для добавления примера голоса
   - Конвертирует OGG в WAV через ffmpeg

ВОЗМОЖНОСТИ:
------------

1. БИБЛИОТЕКА ГОЛОСОВ:
   - Dropdown выбор сохраненных голосов
   - Кнопка "Load Voice" - загрузить выбранный голос в Reference Audio
   - Кнопка "Refresh" - обновить список голосов

2. СОХРАНЕНИЕ НОВЫХ ГОЛОСОВ:
   - Поле "Voice Name" - имя для нового голоса
   - Загрузка аудио файла
   - Trim слайдеры (Start/End) - обрезка начала и конца
   - Автоматическая подстройка максимума слайдера под длину аудио
   - Поле "Reference Text" - текст образца
   - Кнопка "Save Voice" - сохранить в библиотеку

3. СТРУКТУРА ХРАНЕНИЯ:
   voices/
     Voice_Name/
       audio.wav         - обрезанное аудио (mono, 24kHz)
       metadata.json     - метаданные голоса

   metadata.json содержит:
   {
     "ref_text": "текст без ударений",
     "ref_text_with_stress": "+текст с +ударениями",
     "created": "2025-10-12T01:22:37.346996",
     "sample_rate": 24000,
     "duration": 34.28,
     "source": "описание источника"
   }

ИСПОЛЬЗОВАНИЕ:
--------------

ШАГ 1: Запустить Gradio интерфейс
  python -m f5_tts.infer.infer_gradio

ШАГ 2: Открыть вкладку "Basic-TTS"

ШАГ 3А: Загрузить сохраненный голос
  1. Выбрать голос из dropdown "Saved Voices"
  2. Нажать "Load Voice"
  3. Голос автоматически загрузится в Reference Audio и Reference Text

ШАГ 3Б: Сохранить новый голос
  1. Открыть "Save New Voice"
  2. Ввести имя голоса
  3. Загрузить аудио файл (MP3, WAV, OGG и т.д.)
  4. Подстроить слайдеры обрезки (Start/End)
  5. Ввести текст образца
  6. Нажать "Save Voice"
  7. Голос сохранится в voices/Voice_Name/

ШАГ 4: Генерация речи
  Использовать как обычно с загруженным голосом

ПРИМЕРЫ ГОЛОСОВ:
----------------

1. Example_Voice (УЖЕ ДОБАВЛЕН)
   - Источник: audio_2025-10-10_23-22-57.ogg
   - Длительность: 34.3 секунды
   - Текст: "Я подарю тебе вселенную - самоуверенные слова..."
   - Доступен сразу после установки

ДОБАВЛЕНИЕ ГОЛОСОВ СКРИПТОМ:
----------------------------

Если нужно добавить голос программно:

python add_example_voice.py

Или изменить скрипт:

voice_name = "My_Voice"
audio_source = r"C:\path\to\audio.mp3"
ref_text = "Текст который произносит голос"

ТЕХНИЧЕСКИЕ ДЕТАЛИ:
-------------------

1. TRIM ИНТЕРФЕЙС:
   - Слайдеры автоматически обновляются при загрузке аудио
   - Максимум = длительность аудио файла
   - Start = 0, End = длительность по умолчанию

2. КОНВЕРТАЦИЯ АУДИО:
   - Все аудио конвертируется в WAV
   - Mono (1 канал)
   - 24kHz sample rate (оптимально для F5-TTS)
   - Требует ffmpeg в PATH

3. ПОДДЕРЖИВАЕМЫЕ ФОРМАТЫ:
   - Входные: MP3, WAV, OGG, M4A, FLAC и другие (через ffmpeg)
   - Выходные: WAV (24kHz mono)

4. ИНТЕГРАЦИЯ С GRADIO:
   - Accordion "Voice Library" в Basic-TTS tab
   - Сохраненные голоса загружаются при старте
   - State сохраняется между сессиями (файлы на диске)

РЕКОМЕНДАЦИИ:
-------------

1. КАЧЕСТВО ГОЛОСА:
   - Используйте чистые записи без шума
   - 10-15 секунд оптимально для референса
   - Избегайте длинных пауз в начале/конце (используйте trim)

2. РЕФЕРЕНСНЫЙ ТЕКСТ:
   - Точно соответствует произнесенному тексту
   - Для русского можно указывать ударения через "+"
   - Помогает модели лучше выровнять фонемы

3. ОРГАНИЗАЦИЯ:
   - Давайте понятные имена голосам (Speaker1, Female_Calm, etc.)
   - Можно использовать подчеркивания, избегайте пробелов
   - Описывайте источник в metadata для удобства

ИЗВЕСТНЫЕ ПРОБЛЕМЫ:
-------------------

1. Unicode в консоли Windows:
   - При запуске скрипта русский текст может отображаться как "????"
   - Это только визуальная проблема, файлы сохраняются правильно в UTF-8

2. Требуется ffmpeg:
   - Для конвертации OGG/MP3 в WAV нужен ffmpeg
   - Установка: https://ffmpeg.org/download.html

3. Gradio показывает путь к файлу:
   - При загрузке голоса показывается полный путь к voices/Voice_Name/audio.wav
   - Это нормально, аудио корректно загружается

БУДУЩИЕ УЛУЧШЕНИЯ:
-------------------

1. Preview аудио перед сохранением
2. Удаление голосов из библиотеки
3. Редактирование метаданных
4. Экспорт/импорт голосов
5. Автоматическая транскрипция через Whisper
6. Визуализация waveform для trim

================================================================================
